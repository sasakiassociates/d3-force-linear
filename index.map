{"version":3,"file":null,"sources":["src/forceLinear.js"],"sourcesContent":["function linearPack(alpha, strength, padding) {\n    let nodes,\n        quadtree;\n\n    function initialize() {\n        if (!nodes) return;\n        if (!strength) strength = 5;\n        if (!padding) padding = 1;\n        if (!alpha) alpha = 0;\n        quadtree = d3.quadtree()\n                     .x((d) => d.x)\n                     .y((d) => d.y)\n                     .addAll(nodes);\n    }\n\n    function pullToX(d) {\n        d.y += (d.idealcy - d.y) * alpha * strength;\n        d.x += (d.idealcx - d.x) * alpha;\n        return d;\n    }\n\n    function collide(d) { // ref: https://bl.ocks.org/mbostock/7881887\n        var alphaC = 0.5; // todo: comment\n        var r = d.radius + padding,\n            nx1 = d.x - r,\n            nx2 = d.x + r,\n            ny1 = d.y - r,\n            ny2 = d.y + r;\n        quadtree.visit(function(quad, x1, y1, x2, y2) {\n            if (quad.data && (quad.data !== d)) {\n                var x = d.x - quad.data.x,\n                    y = d.y - quad.data.y,\n                    l = Math.sqrt(x * x + y * y),\n                    r = d.radius + quad.data.radius + padding;\n                if (l < r) {\n                    l = (l - r) / l * alphaC;\n                    d.x -= x *= l;\n                    d.y -= y *= l;\n                    quad.data.x += x;\n                    quad.data.y += y;\n                }\n            }\n            return x1 > nx2 || x2 < nx1 || y1 > ny2 || y2 < ny1;\n        });\n    }\n\n    function force () {\n        if (!alpha) return;\n\n        nodes.forEach(function (node) {\n            pullToX(node);\n            collide(node);\n        });\n    }\n\n     force.initialize = _ => {\n         nodes = _;\n         initialize();\n     };\n\n    return force;\n}\n\nexport default linearPack;\n\nexport function initializeLinearPack (nodes) {\n    let clusters = {};\n\n    function getPosition (n) {\n        var tau = 1 / 2 + Math.sqrt(5) / 2;\n        var r = Math.sqrt(n + 1 / 2);\n        var theta = n * (2 * Math.PI / tau);\n        return plotPoint(r, theta);\n    }\n\n    function plotPoint (r, theta) {\n        var x = r * Math.sin(theta);\n        var y = r * Math.cos(theta);\n        return {x: x, y: y};\n    }\n\n    return nodes.map(function (d) {\n        var existingPositions = [];\n        if (d.radius && d.idealcx) {\n            var cluster = Math.round(d.idealcx);\n            if (!clusters[cluster]) {\n                clusters[cluster] = 0;\n            }\n            while(true) {\n                var pos = getPosition(clusters[cluster]);\n                d.x = pos.x + d.idealcx;\n                d.y = pos.y+ d.idealcy;\n                clusters[cluster]++;\n                if (!existingPositions.some(function (val, i) {\n                        return (val.x == d.x && val.y == d.y);\n                })) break;\n            }\n            existingPositions.push(d);\n            return d;\n        }\n    });\n}"],"names":["linearPack","alpha","strength","padding","nodes","quadtree","initialize","d3","x","d","y","addAll","pullToX","idealcy","idealcx","collide","alphaC","r","radius","nx1","nx2","ny1","ny2","visit","quad","x1","y1","x2","y2","data","l","Math","sqrt","force","forEach","node","_","initializeLinearPack","clusters","getPosition","n","tau","theta","PI","plotPoint","sin","cos","map","existingPositions","cluster","round","pos","some","val","i","push"],"mappings":"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"}